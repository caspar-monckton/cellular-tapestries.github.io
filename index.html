<!DOCTYPE html>
<html>

<head>
	<title>Cellular Tapestries</title>
	<style>
		.grid-container {
			display: grid;
			grid-template-columns: 1fr 1fr 1fr;
			grid-gap: 10px;
			padding-bottom: 120px
		}
	</style>
</head>

<body>

	<h1>About</h1>
	<p>
		The tapestries are generated by space-time diagrams of 1-D cellular automata with n states. Select the ones you like and they will randomly mutate and cross breed with one another to produce more patterns.
	</p>
	
	<div>
	<button onclick ="reset_parents()">reset parents</button>
	<div class="grid-container">

		<div>
			<h3>Parent 1</h3>
			<canvas id="parent1" width="400" height="400"></canvas>
			<button onclick ="delete_parent(parent1)">remove from gene pool</button>
			
		</div>
		<div>
			<h3>Parent 2</h3>
			<canvas id="parent2" width="400" height="400"></canvas>
			<button onclick ="delete_parent(parent2)">remove from gene pool</button>
			
		</div>
	</div>
	</div>
	
	<div class="grid-container">
		<div>
			<h3>Child 1</h3>
			<canvas id="child1" width="400" height="400"></canvas>
			<button onclick ="select_child(current_children[0])">add to gene pool</button>
			
		</div>
		<div>
			<h3>Child 2</h3>
			<canvas id="child2" width="400" height="400"></canvas>
			<button onclick ="select_child(current_children[1])">add to gene pool</button>
			
		</div>
		<div>
			<h3>Child 3</h3>
			<canvas id="child3" width="400" height="400"></canvas>
			<button onclick ="select_child(current_children[2])">add to gene pool</button>

		</div>
		<div>
			<h3>Child 4</h3>
			<canvas id="child4" width="400" height="400"></canvas>
			<button onclick ="select_child(current_children[3])">add to gene pool</button>

		</div>
	</div>
	

	<script src="ca_engine.js"></script>
	<script src="view_handler.js"></script>
	<script>
		const num_children = 4;
		const children_canvases = [document.getElementById("child1"), document.getElementById("child2"), document.getElementById("child3"), document.getElementById("child4")];
		let current_children = [];
		const pattern_base = [];

		
		for (let i = 0; i < 64; i++) {
			pattern_base.push(i);
		}
		
		const canvas1 = document.getElementById("parent1");
		const canvas2 = document.getElementById("parent2");
		env = new Environment(4);
		
		let parent1 = sample_list(env.cool_rules, 1)[0];
		let parent2 = sample_list(env.cool_rules, 1)[0];
		
		function reset_children() {
			current_children = [];
		}
				
		function reset_parents() {
			parent1 = sample_list(env.cool_rules, 1)[0];
			parent2 = sample_list(env.cool_rules, 1)[0];

			display_tapestry(canvas1, generate_tapestry_data(parent1, generate_random_tape(4, 200), 200));
			display_tapestry(canvas2, generate_tapestry_data(parent2, generate_random_tape(4, 200), 200));
			
			reset_children();
			for (let i = 0; i < num_children; i++) {
				current_children.push(
					crossover_reproduce(parent1, parent2, sample_list(pattern_base, 32)).produce_mutated_child(env.mutation_rate)
				);
			}
		
			for (const [x, child_canvas] of children_canvases.entries()) {
				display_tapestry(child_canvas, generate_tapestry_data(current_children[x], generate_random_tape(4, 200), 200));
			}
		}
		
		function delete_parent(parent) {
			for (const [x, rule] of env.cool_rules.entries()) {
				if (rule === parent) {
					env.cool_rules.splice(x, 1);
				}
			}
		}
		
		function select_child(child) {
			env.cool_rules.push(child);
		}
		
		reset_parents();
	</script>

</body>
</html>
