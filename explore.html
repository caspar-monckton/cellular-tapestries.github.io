<!DOCTYPE html>
<html>
<head>
<style>

	.live-tape-editor {
		overflow: auto;
		white-space: nowrap;
		display: flex;
	}
	
	
	.tape-cell {
            padding: 40px 20px;
            font-size: 30px;
            border-radius: 10px;
            border: 2px solid black;
	}
	
	.tape-buffer {
			overflow: auto;
            padding: 40px 60px;
            border-radius: 5px;
            border-size: 2px;
			background-color: #000000
	}
	
	#tape-controls {
		white-space: nowrap;
		display: flex;
		overflow: auto;
	}
	
	.selector-box {
		padding: 3px;
		border: 2px solid black;
	}
	

</style>

<title>Cellular Tapestries</title>

</head>
<body>
<h1>Tapestry Explorer</h1>
<p>Create your own tape to explore the variation that exists within the selected rule. Select a colour with the state selector and click a tape cell to change the colour of that cell to the selected colour. Try generating random tapes or blank tapes and then modifying them. Support is on its way for saving custom tapes and combining them. Press Render Tape at the bottom to create a tapestry. The rules are deterministic, meaning that if you input the same tape twice, the rule will output the same tapestry.</p>
<h1><a href="gallery.html">Back to Gallery</a></h1>
<h1><a href="index.html">Home</a></h1>

<div id="rule-preview">
	<canvas id="selected-rule" width="200" height="200"></canvas>
</div>

<div id="tape-controls">
	<button id="generate-blank-tape" onclick="add_blank_env_tape()">Generate Blank Tape</button>
	<button id="generate-blank-tape" onclick="add_random_env_tape()">Generate Random Tape</button>
	
	<button id="clear-tape" onclick="clear_current_tape()">Clear Tape</button>	
	
		<div id='colour-selector-box' class="selector-box">
		State Selector
		<input type='radio' name='colour-selector' value='0' checked onclick = "select_state('0')">0</input>
		<input type='radio' name='colour-selector' value='1' onclick = "select_state('1')">1</input>
		<input type='radio' name='colour-selector' value='2' onclick = "select_state('2')">2</input>
		<input type='radio' name='colour-selector' value='3' onclick = "select_state('3')">3</input>
		</div>
		
		<div id='size-selector-box' class="selector-box">
		State Selector
		<input type='radio' name='size-selector' value='0' onclick = "select_size('50')">50 cells</input>
		<input type='radio' name='size-selector' value='1' checked onclick = "select_size('100')">100 cells</input>
		<input type='radio' name='size-selector' value='2' onclick = "select_size('200')">200</input>
		<input type='radio' name='size-selector' value='3' onclick = "select_size('400')">400</input>
		<input type='radio' name='size-selector' value='3' onclick = "select_size('800')">800</input>
		
		
		</div>
</div>

<div id="tape-box">
	<div id="main-tape" class="live-tape-editor"></div>
</div>

<div id="tape-list">
</div>

<div id="render-controls">
	<button id="render-tape-button" onclick = "render_current_tape()">Render Tape</button>
	<div>
	<canvas id="tapestry-display" width="800" height="800"></canvas>
	</div>
</div>

<!-- Render the tape -->
<script src="ca_engine.js"></script>
<script src="view_handler.js"></script>
<script>
	const context = {
		selected_rule: new Rule(JSON.parse(localStorage.getItem('selectedRule')), 4),
		current_colour: 0,
		tape_length: 100
	};

	tape_env = new TapeEnvironment(4);
	
	display_tapestry(document.getElementById("selected-rule"), generate_tapestry_data(context.selected_rule, generate_random_tape(tape_env._num_states, 200), 200));
	
	
	load_live_tape(document.getElementById("main-tape"), null, context);

	
	function select_state(state_string) {
		let state = parseInt(state_string);
		const states = [0, 1, 2, 3];
		if (states.includes(state)) {
			context.current_colour = state;
		}
		//console.log(current_colour);
	}
	
	function select_size(size_string) {
		context.tape_length = parseInt(size_string);
		clear_current_tape();
	}
	
	function add_blank_env_tape() {
		const new_tape = generate_blank_tape(context.current_colour, tape_env._num_states, context.tape_length);
		tape_env.load_new_tape(new_tape);
		load_live_tape(document.getElementById("main-tape"), tape_env.loaded_tape, context);
	}
	
	function add_random_env_tape() {
		const new_tape = generate_random_tape(tape_env._num_states, context.tape_length);
		tape_env.load_new_tape(new_tape);
		load_live_tape(document.getElementById("main-tape"), tape_env.loaded_tape, context);
	}
	
	function clear_current_tape() {
		tape_env.clear_current_tape();
		load_live_tape(document.getElementById("main-tape"), null, context);
	}
	
	function render_current_tape() {
		display = document.getElementById("tapestry-display");
		display_tapestry(display, generate_tapestry_data(context.selected_rule, tape_env.loaded_tape.clone(), context.tape_length));
	}
	
</script>


</body>
</html>